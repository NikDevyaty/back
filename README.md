# Back для бота

### GetStarted
1. Клонировать репозиторий
2. `cd back`
3. `npm i`
4. поднять локально mongodb
5. создать .env на основе .env.example
6. `npm run dev`

- важно иметь установленную node.js 
- о том, как установить и запустить mongoDB https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-windows/

### TODO
* дописать обработчики добавления по реферальной ссылке
* стоит позднее переписать на хуки вместо polling (сложно тестировать локально, пока не решён вопрос)
* написать автотесты
* добавить в схему локализацию пользователя и учесть это при рассылках
* поставить веб-сокет для соединения с игрой
* настроить ci/cd с сервером

### Docs
- Следите за импортами. текущая реализация допускает автоимпорты от src, но в build папке нет src директории и это приведет к ошибкам. Возможно стоит поставить сборщик или просто внутри build таки создавать src.  Возможны иные варианты.
- логи пишутся в logs корневой директории. Имеет смысл подумать над форматом логов - возможно текущий выбран неудачно. Срок жизни 7 дней, затем старый файл должен уйти в .old версию.
- настроен централизованный обработчик ошибок в app (не внутри bot). Просто выбрасывайте next({message: string, err: {someInfo}, status: number}). Статус ошибки по умолчанию 500.
- cors настроен пропускать только сайти из .env.
- стоит helmet.
- 

| Скрипт          | Описание                                                                                           |
|-----------------|----------------------------------------------------------------------------------------------------|
| dev             | Запускает приложение в режиме разработки с помощью TypeScript и автоматической пересборки.       |
| build           | Удаляет предыдущую сборку и компилирует проект с помощью TypeScript.                               |
| start-linux     | Собирает приложение для Linux и запускает его.                                                     |
| start-windows   | Собирает приложение для Windows и запускает его.                                                   |
| lint            | Запускает линтер ESLint для проверки кода в директории src.                                        |
| format          | Запускает ESLint с флагом --fix для автоматической коррекции стилевых ошибок в коде.                |
| build-linux     | Собирает проект для Linux, копирует папку assets и файл .env в директорию build для деплоя на Linux. |
| build-windows   | Собирает проект для Windows, копирует папку assets и файл .env в директорию build для деплоя на Windows. |



